<!DOCTYPE html> <html><head>
		<title>网络层-数据平面</title>
		<base href="../../../../">
		<meta id="root-path" root-path="../../../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Course-Notes - 网络层-数据平面">
		<meta property="og:title" content="网络层-数据平面">
		<meta property="og:description" content="Course-Notes - 网络层-数据平面">
		<meta property="og:type" content="website">
		<meta property="og:url" content="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html">
		<meta property="og:image" content="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231116172535.png">
		<meta property="og:site_name" content="Course-Notes">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-c.mjx-c2295::before { padding: 0.583em 0.778em 0.083em 0px; content: "⊕"; }
mjx-c.mjx-c2026::before { padding: 0.12em 1.172em 0px 0px; content: "…"; }
mjx-c.mjx-c1D43E.TEX-I::before { padding: 0.683em 0.889em 0px 0px; content: "K"; }
mjx-mspace { display: inline-block; text-align: left; }
mjx-c.mjx-c1D44F.TEX-I::before { padding: 0.694em 0.429em 0.011em 0px; content: "b"; }
mjx-c.mjx-c1D707.TEX-I::before { padding: 0.442em 0.603em 0.216em 0px; content: "μ"; }
mjx-c.mjx-c73::before { padding: 0.448em 0.394em 0.011em 0px; content: "s"; }
mjx-c.mjx-c1D448.TEX-I::before { padding: 0.683em 0.767em 0.022em 0px; content: "U"; }
mjx-c.mjx-c3C::before { padding: 0.54em 0.778em 0.04em 0px; content: "<"; }
mjx-c.mjx-c1D6FC.TEX-I::before { padding: 0.442em 0.64em 0.011em 0px; content: "α"; }
mjx-c.mjx-c1D6FD.TEX-I::before { padding: 0.705em 0.566em 0.194em 0px; content: "β"; }
mjx-c.mjx-c1D43C.TEX-I::before { padding: 0.683em 0.504em 0px 0px; content: "I"; }
mjx-c.mjx-c2264::before { padding: 0.636em 0.778em 0.138em 0px; content: "≤"; }
mjx-c.mjx-c1D453.TEX-I::before { padding: 0.705em 0.55em 0.205em 0px; content: "f"; }
mjx-c.mjx-c1D434.TEX-I::before { padding: 0.716em 0.75em 0px 0px; content: "A"; }
mjx-c.mjx-c1D706.TEX-I::before { padding: 0.694em 0.583em 0.012em 0px; content: "λ"; }
mjx-c.mjx-cD7::before { padding: 0.491em 0.778em 0px 0px; content: "×"; }
mjx-c.mjx-c1D44A.TEX-I::before { padding: 0.683em 1.048em 0.022em 0px; content: "W"; }
mjx-c.mjx-c1D440.TEX-I::before { padding: 0.683em 1.051em 0px 0px; content: "M"; }
mjx-msqrt { display: inline-block; text-align: left; }
mjx-root { display: inline-block; white-space: nowrap; }
mjx-surd { display: inline-block; vertical-align: top; }
mjx-sqrt { display: inline-block; padding-top: 0.07em; }
mjx-sqrt > mjx-box { border-top: 0.07em solid; }
mjx-sqrt.mjx-tall > mjx-box { padding-left: 0.3em; margin-left: -0.3em; }
mjx-c.mjx-c1D435.TEX-I::before { padding: 0.683em 0.759em 0px 0px; content: "B"; }
mjx-c.mjx-c1D447.TEX-I::before { padding: 0.677em 0.704em 0px 0px; content: "T"; }
mjx-c.mjx-c22C5::before { padding: 0.31em 0.278em 0px 0px; content: "⋅"; }
mjx-c.mjx-c1D436.TEX-I::before { padding: 0.705em 0.76em 0.022em 0px; content: "C"; }
mjx-c.mjx-c221A::before { padding: 0.8em 0.853em 0.2em 0px; content: "√"; }
mjx-c.mjx-c3A3::before { padding: 0.683em 0.722em 0px 0px; content: "Σ"; }
mjx-c.mjx-c1D457.TEX-I::before { padding: 0.661em 0.412em 0.204em 0px; content: "j"; }
mjx-c.mjx-c1D43A.TEX-I::before { padding: 0.705em 0.786em 0.022em 0px; content: "G"; }
mjx-c.mjx-c1D438.TEX-I::before { padding: 0.68em 0.764em 0px 0px; content: "E"; }
mjx-c.mjx-c1D466.TEX-I::before { padding: 0.442em 0.49em 0.205em 0px; content: "y"; }
mjx-c.mjx-c221E::before { padding: 0.442em 1em 0.011em 0px; content: "∞"; }
mjx-c.mjx-c1D467.TEX-I::before { padding: 0.442em 0.465em 0.011em 0px; content: "z"; }
mjx-c.mjx-c1D464.TEX-I::before { padding: 0.443em 0.716em 0.011em 0px; content: "w"; }
mjx-c.mjx-c1D463.TEX-I::before { padding: 0.443em 0.485em 0.011em 0px; content: "v"; }
mjx-c.mjx-c2217::before { padding: 0.465em 0.5em 0px 0px; content: "∗"; }
mjx-c.mjx-c5B::before { padding: 0.75em 0.278em 0.25em 0px; content: "["; }
mjx-c.mjx-c3A::before { padding: 0.43em 0.278em 0px 0px; content: ":"; }
mjx-c.mjx-c2208::before { padding: 0.54em 0.667em 0.04em 0px; content: "∈"; }
mjx-c.mjx-c5D::before { padding: 0.75em 0.278em 0.25em 0px; content: "]"; }
mjx-c.mjx-c34::before { padding: 0.677em 0.5em 0px 0px; content: "4"; }
mjx-c.mjx-c35::before { padding: 0.666em 0.5em 0.022em 0px; content: "5"; }
mjx-c.mjx-c6D::before { padding: 0.442em 0.833em 0px 0px; content: "m"; }
mjx-c.mjx-c69::before { padding: 0.669em 0.278em 0px 0px; content: "i"; }
mjx-c.mjx-c6E::before { padding: 0.442em 0.556em 0px 0px; content: "n"; }
mjx-c.mjx-c36::before { padding: 0.666em 0.5em 0.022em 0px; content: "6"; }
mjx-c.mjx-c37::before { padding: 0.676em 0.5em 0.022em 0px; content: "7"; }
mjx-c.mjx-c33::before { padding: 0.665em 0.5em 0.022em 0px; content: "3"; }
mjx-c.mjx-c38::before { padding: 0.666em 0.5em 0.022em 0px; content: "8"; }
mjx-c.mjx-c39::before { padding: 0.666em 0.5em 0.022em 0px; content: "9"; }
mjx-c.mjx-c1D442.TEX-I::before { padding: 0.704em 0.763em 0.022em 0px; content: "O"; }
mjx-c.mjx-c7C::before { padding: 0.75em 0.278em 0.249em 0px; content: "|"; }
mjx-c.mjx-c1D456.TEX-I::before { padding: 0.661em 0.345em 0.011em 0px; content: "i"; }
mjx-c.mjx-c1D439.TEX-I::before { padding: 0.68em 0.749em 0px 0px; content: "F"; }
mjx-c.mjx-c1D45A.TEX-I::before { padding: 0.442em 0.878em 0.011em 0px; content: "m"; }
mjx-c.mjx-c7B::before { padding: 0.75em 0.5em 0.25em 0px; content: "{"; }
mjx-c.mjx-c31::before { padding: 0.666em 0.5em 0px 0px; content: "1"; }
mjx-c.mjx-c2C::before { padding: 0.121em 0.278em 0.194em 0px; content: ","; }
mjx-c.mjx-c2E::before { padding: 0.12em 0.278em 0px 0px; content: "."; }
mjx-c.mjx-c7D::before { padding: 0.75em 0.5em 0.25em 0px; content: "}"; }
mjx-c.mjx-c1D437.TEX-I::before { padding: 0.683em 0.828em 0px 0px; content: "D"; }
mjx-c.mjx-c1D465.TEX-I::before { padding: 0.442em 0.572em 0.011em 0px; content: "x"; }
mjx-c.mjx-c7B.TEX-S3::before { padding: 1.45em 0.75em 0.949em 0px; content: "{"; }
mjx-c.mjx-c7D.TEX-S3::before { padding: 1.45em 0.75em 0.949em 0px; content: "}"; }
mjx-c.mjx-c30::before { padding: 0.666em 0.5em 0.022em 0px; content: "0"; }
mjx-c.mjx-c2265::before { padding: 0.636em 0.778em 0.138em 0px; content: "≥"; }
mjx-c.mjx-c1D446.TEX-I::before { padding: 0.705em 0.645em 0.022em 0px; content: "S"; }
mjx-msub { display: inline-block; text-align: left; }
mjx-texatom { display: inline-block; text-align: left; }
mjx-c.mjx-c1D451.TEX-I::before { padding: 0.694em 0.52em 0.01em 0px; content: "d"; }
mjx-c.mjx-c1D441.TEX-I::before { padding: 0.683em 0.888em 0px 0px; content: "N"; }
mjx-c.mjx-c1D43F.TEX-I::before { padding: 0.683em 0.681em 0px 0px; content: "L"; }
mjx-c.mjx-c2F::before { padding: 0.75em 0.5em 0.25em 0px; content: "/"; }
mjx-c.mjx-c1D445.TEX-I::before { padding: 0.683em 0.759em 0.021em 0px; content: "R"; }
mjx-c.mjx-c1D45B.TEX-I::before { padding: 0.442em 0.6em 0.011em 0px; content: "n"; }
mjx-c.mjx-c1D45C.TEX-I::before { padding: 0.441em 0.485em 0.011em 0px; content: "o"; }
mjx-c.mjx-c1D44E.TEX-I::before { padding: 0.441em 0.529em 0.01em 0px; content: "a"; }
mjx-c.mjx-c1D459.TEX-I::before { padding: 0.694em 0.298em 0.011em 0px; content: "l"; }
mjx-c.mjx-c1D45D.TEX-I::before { padding: 0.442em 0.503em 0.194em 0px; content: "p"; }
mjx-c.mjx-c1D45F.TEX-I::before { padding: 0.442em 0.451em 0.011em 0px; content: "r"; }
mjx-c.mjx-c1D450.TEX-I::before { padding: 0.442em 0.433em 0.011em 0px; content: "c"; }
mjx-c.mjx-c2B::before { padding: 0.583em 0.778em 0.082em 0px; content: "+"; }
mjx-c.mjx-c1D45E.TEX-I::before { padding: 0.442em 0.46em 0.194em 0px; content: "q"; }
mjx-c.mjx-c1D462.TEX-I::before { padding: 0.442em 0.572em 0.011em 0px; content: "u"; }
mjx-c.mjx-c1D452.TEX-I::before { padding: 0.442em 0.466em 0.011em 0px; content: "e"; }
mjx-c.mjx-c1D461.TEX-I::before { padding: 0.626em 0.361em 0.011em 0px; content: "t"; }
mjx-c.mjx-c1D460.TEX-I::before { padding: 0.442em 0.469em 0.01em 0px; content: "s"; }
mjx-c.mjx-c28::before { padding: 0.75em 0.389em 0.25em 0px; content: "("; }
mjx-c.mjx-c29::before { padding: 0.75em 0.389em 0.25em 0px; content: ")"; }
mjx-mo { display: inline-block; text-align: left; }
mjx-stretchy-h { display: inline-table; width: 100%; }
mjx-stretchy-h > * { display: table-cell; width: 0px; }
mjx-stretchy-h > * > mjx-c { display: inline-block; transform: scaleX(1); }
mjx-stretchy-h > * > mjx-c::before { display: inline-block; width: initial; }
mjx-stretchy-h > mjx-ext { overflow: clip visible; width: 100%; }
mjx-stretchy-h > mjx-ext > mjx-c::before { transform: scaleX(500); }
mjx-stretchy-h > mjx-ext > mjx-c { width: 0px; }
mjx-stretchy-h > mjx-beg > mjx-c { margin-right: -0.1em; }
mjx-stretchy-h > mjx-end > mjx-c { margin-left: -0.1em; }
mjx-stretchy-v { display: inline-block; }
mjx-stretchy-v > * { display: block; }
mjx-stretchy-v > mjx-beg { height: 0px; }
mjx-stretchy-v > mjx-end > mjx-c { display: block; }
mjx-stretchy-v > * > mjx-c { transform: scaleY(1); transform-origin: left center; overflow: hidden; }
mjx-stretchy-v > mjx-ext { display: block; height: 100%; box-sizing: border-box; border: 0px solid transparent; overflow: visible clip; }
mjx-stretchy-v > mjx-ext > mjx-c::before { width: initial; box-sizing: border-box; }
mjx-stretchy-v > mjx-ext > mjx-c { transform: scaleY(500) translateY(0.075em); overflow: visible; }
mjx-mark { display: inline-block; height: 0px; }
mjx-mfrac { display: inline-block; text-align: left; }
mjx-frac { display: inline-block; vertical-align: 0.17em; padding: 0px 0.22em; }
mjx-frac[type="d"] { vertical-align: 0.04em; }
mjx-frac[delims] { padding: 0px 0.1em; }
mjx-frac[atop] { padding: 0px 0.12em; }
mjx-frac[atop][delims] { padding: 0px; }
mjx-dtable { display: inline-table; width: 100%; }
mjx-dtable > * { font-size: 2000%; }
mjx-dbox { display: block; font-size: 5%; }
mjx-num { display: block; text-align: center; }
mjx-den { display: block; text-align: center; }
mjx-mfrac[bevelled] > mjx-num { display: inline-block; }
mjx-mfrac[bevelled] > mjx-den { display: inline-block; }
mjx-den[align="right"], mjx-num[align="right"] { text-align: right; }
mjx-den[align="left"], mjx-num[align="left"] { text-align: left; }
mjx-nstrut { display: inline-block; height: 0.054em; width: 0px; vertical-align: -0.054em; }
mjx-nstrut[type="d"] { height: 0.217em; vertical-align: -0.217em; }
mjx-dstrut { display: inline-block; height: 0.505em; width: 0px; }
mjx-dstrut[type="d"] { height: 0.726em; }
mjx-line { display: block; box-sizing: border-box; min-height: 1px; height: 0.06em; border-top: 0.06em solid; margin: 0.06em -0.1em; overflow: hidden; }
mjx-line[type="d"] { margin: 0.18em -0.1em; }
mjx-mrow { display: inline-block; text-align: left; }
mjx-c.mjx-c3D::before { padding: 0.583em 0.778em 0.082em 0px; content: "="; }
mjx-c.mjx-c2212::before { padding: 0.583em 0.778em 0.082em 0px; content: "−"; }
mjx-container[jax="CHTML"] { line-height: 0; }
mjx-container [space="1"] { margin-left: 0.111em; }
mjx-container [space="2"] { margin-left: 0.167em; }
mjx-container [space="3"] { margin-left: 0.222em; }
mjx-container [space="4"] { margin-left: 0.278em; }
mjx-container [space="5"] { margin-left: 0.333em; }
mjx-container [rspace="1"] { margin-right: 0.111em; }
mjx-container [rspace="2"] { margin-right: 0.167em; }
mjx-container [rspace="3"] { margin-right: 0.222em; }
mjx-container [rspace="4"] { margin-right: 0.278em; }
mjx-container [rspace="5"] { margin-right: 0.333em; }
mjx-container [size="s"] { font-size: 70.7%; }
mjx-container [size="ss"] { font-size: 50%; }
mjx-container [size="Tn"] { font-size: 60%; }
mjx-container [size="sm"] { font-size: 85%; }
mjx-container [size="lg"] { font-size: 120%; }
mjx-container [size="Lg"] { font-size: 144%; }
mjx-container [size="LG"] { font-size: 173%; }
mjx-container [size="hg"] { font-size: 207%; }
mjx-container [size="HG"] { font-size: 249%; }
mjx-container [width="full"] { width: 100%; }
mjx-box { display: inline-block; }
mjx-block { display: block; }
mjx-itable { display: inline-table; }
mjx-row { display: table-row; }
mjx-row > * { display: table-cell; }
mjx-mtext { display: inline-block; }
mjx-mstyle { display: inline-block; }
mjx-merror { display: inline-block; color: red; background-color: yellow; }
mjx-mphantom { visibility: hidden; }
mjx-assistive-mml { top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: absolute !important; padding: 1px 0px 0px !important; border: 0px !important; display: block !important; width: auto !important; overflow: hidden !important; }
mjx-assistive-mml[display="block"] { width: 100% !important; }
mjx-math { display: inline-block; text-align: left; line-height: 0; text-indent: 0px; font-style: normal; font-weight: normal; font-size: 100%; letter-spacing: normal; border-collapse: collapse; overflow-wrap: normal; word-spacing: normal; white-space: nowrap; direction: ltr; padding: 1px 0px; }
mjx-container[jax="CHTML"][display="true"] { display: block; text-align: center; margin: 1em 0px; }
mjx-container[jax="CHTML"][display="true"][width="full"] { display: flex; }
mjx-container[jax="CHTML"][display="true"] mjx-math { padding: 0px; }
mjx-container[jax="CHTML"][justify="left"] { text-align: left; }
mjx-container[jax="CHTML"][justify="right"] { text-align: right; }
mjx-msup { display: inline-block; text-align: left; }
mjx-mn { display: inline-block; text-align: left; }
mjx-c { display: inline-block; }
mjx-utext { display: inline-block; padding: 0.75em 0px 0.2em; }
mjx-mi { display: inline-block; text-align: left; }
mjx-c::before { display: block; width: 0px; }
.MJX-TEX { font-family: MJXZERO, MJXTEX; }
.TEX-B { font-family: MJXZERO, MJXTEX-B; }
.TEX-I { font-family: MJXZERO, MJXTEX-I; }
.TEX-MI { font-family: MJXZERO, MJXTEX-MI; }
.TEX-BI { font-family: MJXZERO, MJXTEX-BI; }
.TEX-S1 { font-family: MJXZERO, MJXTEX-S1; }
.TEX-S2 { font-family: MJXZERO, MJXTEX-S2; }
.TEX-S3 { font-family: MJXZERO, MJXTEX-S3; }
.TEX-S4 { font-family: MJXZERO, MJXTEX-S4; }
.TEX-A { font-family: MJXZERO, MJXTEX-A; }
.TEX-C { font-family: MJXZERO, MJXTEX-C; }
.TEX-CB { font-family: MJXZERO, MJXTEX-CB; }
.TEX-FR { font-family: MJXZERO, MJXTEX-FR; }
.TEX-FRB { font-family: MJXZERO, MJXTEX-FRB; }
.TEX-SS { font-family: MJXZERO, MJXTEX-SS; }
.TEX-SSB { font-family: MJXZERO, MJXTEX-SSB; }
.TEX-SSI { font-family: MJXZERO, MJXTEX-SSI; }
.TEX-SC { font-family: MJXZERO, MJXTEX-SC; }
.TEX-T { font-family: MJXZERO, MJXTEX-T; }
.TEX-V { font-family: MJXZERO, MJXTEX-V; }
.TEX-VB { font-family: MJXZERO, MJXTEX-VB; }
mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c { font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A !important; }
@font-face { font-family: MJXZERO; src: url("lib/fonts/mathjax_zero.woff") format("woff"); }
@font-face { font-family: MJXTEX; src: url("lib/fonts/mathjax_main-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-B; src: url("lib/fonts/mathjax_main-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-I; src: url("lib/fonts/mathjax_math-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-MI; src: url("lib/fonts/mathjax_main-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-BI; src: url("lib/fonts/mathjax_math-bolditalic.woff") format("woff"); }
@font-face { font-family: MJXTEX-S1; src: url("lib/fonts/mathjax_size1-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S2; src: url("lib/fonts/mathjax_size2-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S3; src: url("lib/fonts/mathjax_size3-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S4; src: url("lib/fonts/mathjax_size4-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-A; src: url("lib/fonts/mathjax_ams-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-C; src: url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-CB; src: url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-FR; src: url("lib/fonts/mathjax_fraktur-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-FRB; src: url("lib/fonts/mathjax_fraktur-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-SS; src: url("lib/fonts/mathjax_sansserif-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-SSB; src: url("lib/fonts/mathjax_sansserif-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-SSI; src: url("lib/fonts/mathjax_sansserif-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-SC; src: url("lib/fonts/mathjax_script-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-T; src: url("lib/fonts/mathjax_typewriter-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-V; src: url("lib/fonts/mathjax_vector-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-VB; src: url("lib/fonts/mathjax_vector-bold.woff") format("woff"); }
mjx-c.mjx-c32::before { padding: 0.666em 0.5em 0px 0px; content: "2"; }
mjx-c.mjx-c1D458.TEX-I::before { padding: 0.694em 0.521em 0.011em 0px; content: "k"; }
</style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="网络层概述"><p dir="auto">网络层概述</p></h1><div class="heading-wrapper"><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>网络层的分解
<ul dir="auto">
<li data-line="1" dir="auto">数据平面</li>
<li data-line="2" dir="auto">控制平面</li>
</ul>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>数据平面功能:网络中每台路由器的功能，决定到达路由器输入链路之一的数据报如何转发到该路由器的输出链路之一
<ol dir="auto">
<li data-line="4" dir="auto">传统 IP 转发 (转发基于数据报的目的地址)</li>
<li data-line="5" dir="auto">通用转发 (使用数据报首部中几个不同域执行转发和其他功能)</li>
</ol>
</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>控制平面功能:网络范围的逻辑，控制数据报沿着从源主机沿着到目的主机的端到端路径中路由器的路由方式
<ol dir="auto">
<li data-line="7" dir="auto">路由选择算法</li>
</ol>
</li>
<li data-line="8" dir="auto">软件定义网络(Software-Defined Networking, SDN):将控制平面功能作为一种单独服务，明确地分离数据平面和控制平面</li>
</ol></div><div class="heading-wrapper"><h2 data-heading="转发和路由选择:数据平面和控制平面" dir="auto" class="heading" id="转发和路由选择:数据平面和控制平面"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>转发和路由选择:数据平面和控制平面</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>转发(forwarding):将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作
<ul dir="auto">
<li data-line="1" dir="auto">数据平面中实现的唯一功能</li>
<li data-line="2" dir="auto">分组有可能被现有的路由器阻挡也有可能冗余的经过多条链路发送</li>
</ul>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>路由选择(routing):确定分组从源到目的地所采取的端到端路径的网络范围处理过程，通常用软件来实现
<ul dir="auto">
<li data-line="4" dir="auto">路由选择算法(routing algorithm):计算分组从发送方流向接收方时采用的路由或路径</li>
<li data-line="5" dir="auto">在控制平面中实现</li>
</ul>
</li>
<li data-line="6" dir="auto">转发表(forwarding table):路由器检查到达分组首部的一个或多个字段值，进而使用这些首部值在其转发表中索引</li>
<li data-line="7" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>转发表的配置
<ul dir="auto">
<li data-line="8" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>控制平面:传统方法
<ul dir="auto">
<li data-line="9" dir="auto">路由选择算法决定了插入路由器转发表的内容，在一台路由器中的路由选择算法与其他路由器重的算法通信，计算出转发表的值</li>
</ul>
</li>
<li data-line="10" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>控制平面:SDN方法<span alt="Pasted image 20231116172535.png" src="Pasted image 20231116172535.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231116172535.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231116172535.png"></span>
<ul dir="auto">
<li data-line="11" dir="auto">路由选择设备仅执行转发，而远程控制器计算并分发转发表</li>
</ul>
</li>
</ul>
</li>
<li data-line="12" dir="auto">软件定义网络 (Software-Defined Networking, SDN) 的本质：计算转发表并与路由器交互的控制器是用软件实现的 (控制器可能实现在具有高可靠性和冗余的远程数据中心中)</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="网络服务模型" dir="auto" class="heading" id="网络服务模型"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>网络服务模型</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">网络服务模型(network service model)定义了分组在发送和接收端系统之间的端到端运输特性</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>考虑几种网络层能提供的可能的服务：参考<a data-href="应用层#可供应用程序使用的运输服务" href="campus/chinese-notes/计算机科学/计算机网络/应用层.html#可供应用程序使用的运输服务" class="internal-link" target="_self" rel="noopener">应用层 &gt; 可供应用程序使用的运输服务</a>
<ol dir="auto">
<li data-line="2" dir="auto">确保交付</li>
<li data-line="3" dir="auto">具有时延上界的确保交付</li>
<li data-line="4" dir="auto">有序分组交付</li>
<li data-line="5" dir="auto">确保最小带宽</li>
<li data-line="6" dir="auto">安全性</li>
<li data-line="7" dir="auto">很遗憾的是，以上提到的服务，因特网的网络层一个也不提供，因特网的网络层提供了单一的服务，称为<strong>尽力而为服务 (best-effort service)</strong> <del>没有服务就是最好的服务</del></li>
</ol>
</li>
<li data-line="8" dir="auto">尽力而为服务(best-effort service):因特网网络层提供的单一服务，传送的分组既不能保证以发送的顺序被接收，也不能保证最终交付，既不能保证端到端时延，也不能保证有最小的带宽</li>
<li data-line="9" dir="auto">⚠️转发和交换这两个术语经常被互换使用</li>
<li data-line="10" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>分组交换机:通用分组交换设备，根据分组首部字段中的值，从输入链路接口到输出链路接口转移分组
<ul dir="auto">
<li data-line="11" dir="auto">链路层交换机(link-layer switch):基于链路层帧中的字段值做出转发决定</li>
<li data-line="12" dir="auto">路由器(router):基于网络数据报中的首部字段值做出转发决定</li>
</ul>
</li>
</ol></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="路由器工作原理" dir="auto" class="heading" id="路由器工作原理">路由器工作原理</h1><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>路由器组件<span alt="Pasted image 20231117111524.png" src="Pasted image 20231117111524.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231117111524.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117111524.png"></span>
<ul dir="auto">
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输入端口(input port)
<ul dir="auto">
<li data-line="2" dir="auto">终结入物理链路的物理层功能</li>
<li data-line="3" dir="auto">与位于远端的数据链路层交互来执行数据链路层功能</li>
<li data-line="4" dir="auto">查询转发表决定路由器的输出端口</li>
<li data-line="5" dir="auto">控制分组从输入端口(指物理IO接口，与软件端口不同)转发到路由选择处理器</li>
</ul>
</li>
<li data-line="6" dir="auto">交换结构:将路由器的输入端口连接到输出端口，这种交换结构时网络路由器中的网络</li>
<li data-line="7" dir="auto">输出端口:存储从交换结构接收的分组，通过执行必要的链路层和物理层功能在输出链路上传输这些分组(双向链路输出端口总是和输入端口<strong>成对</strong>出现在同一线路卡上)</li>
<li data-line="8" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>路由选择处理器:执行控制平面功能，
<ul dir="auto">
<li data-line="9" dir="auto">传统路由器:执行路由选择协议，维护路由选择表与关联链路状态信息</li>
<li data-line="10" dir="auto">SDN 路由器:负责与远端控制器通信，接收由远程控制器计算的转发表项</li>
</ul>
</li>
</ul>
</li>
<li data-line="11" dir="auto">路由器的输入端口、输出端口和交换结构几乎总是用硬件实现</li>
</ol></div><div class="heading-wrapper"><h3 data-heading="输入端口处理和基于目的地转发" dir="auto" class="heading" id="输入端口处理和基于目的地转发"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输入端口处理和基于目的地转发</h3><div class="heading-children"><div><p dir="auto"><span alt="Pasted image 20231117152150.png" src="Pasted image 20231117152150.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231117152150.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117152150.png" style="width: 500px; max-width: 100%;"></span></p></div><div><ol dir="auto">
<li data-line="0" dir="auto">输入端口的线路端接功能与链路层处理实现了用于各个输入链路的物理层和链路层</li>
<li data-line="1" dir="auto">转发表从路由选择处理器经过独立总线 (eg. PCI) 复制到线路卡</li>
<li data-line="2" dir="auto">使用每个输入端口的影子副本，转发决策可在每个输入端口本地做出，避免了集中式处理瓶颈</li>
<li data-line="3" dir="auto">路由器通过前缀(prefix)匹配来转发分组，当有多个匹配时使用最长前缀匹配规则(longest prefix matching rule) </li>
<li data-line="4" dir="auto">在吉比特速率下，查找转发表必须在纳秒级执行，需要对大型转发表使用超出简单线性搜索的技术，实践中常用三态内容可寻址存储器(Tenary Content Address Memory, TCAM) 来查找，使用 TCAM 一个 32 位 IP 地址可在常数时间内返回对应的转发表项 </li>
<li data-line="5" dir="auto">在某些设计中，如果来自其他输入输出端口的分组当前正在使用该交换结构，一个分组可能在进入交换结构时被阻塞，这个被阻塞的分组需要在输入端口处排队</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输入端口除了查找仍需要处理的事情
<ul dir="auto">
<li data-line="7" dir="auto">物理层和链路层处理</li>
<li data-line="8" dir="auto">检查分组的版本号、检验和以及寿命字段，并重写最后两个字段</li>
<li data-line="9" dir="auto">更新用于网络管理的计数器</li>
</ul>
</li>
</ol></div></div></div><div class="heading-wrapper"><h3 data-heading="交换" dir="auto" class="heading" id="交换"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>交换</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">路由器通过交换结构使分组实际地从一个输入端口交换到另一个输出端口中</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>交换可以用许多方式完成：
<ol dir="auto">
<li data-line="2" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>经内存交换 <span alt="Pasted image 20231117163834.png" src="Pasted image 20231117163834.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20231117163834.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117163834.png" style="width: 400px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="3" dir="auto">最简单、最早的路由器使传统的计算机，输入端口和输出段口之间的交换是在 CPU (路由选择处理器) 的控制下完成的</li>
<li data-line="4" dir="auto">处理首部时分组需要被复制到内存中，所以转发吞吐量受到内存带宽限制</li>
<li data-line="5" dir="auto">共享系统总线一次只能执行一个内存读 / 写，所以不能同时转发两个分组</li>
<li data-line="6" dir="auto">现代路由器由输入线路卡查找目的地址和将分组存储进适当的内存存储位置</li>
</ol>
</li>
<li data-line="7" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>经总线交换 <span alt="Pasted image 20231117163932.png" src="Pasted image 20231117163932.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20231117163932.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117163932.png" style="width: 400px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="8" dir="auto">输入端口经一根共享总线将分组直接传送到输出端口</li>
<li data-line="9" dir="auto">输入端口为分组预先计划一个交换机内部标签，指示本地输出端口，分组被所有输出端口收到，但只有与该标签匹配的端口才能保存该分组</li>
<li data-line="10" dir="auto">一次只有一个分组能跨越总线，交换带宽受总线速率的限制</li>
</ol>
</li>
<li data-line="11" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>经互联网络交换 <span alt="Pasted image 20231117163957.png" src="Pasted image 20231117163957.png" class="internal-embed media-embed image-embed is-loaded" style="width: 400px; max-width: 100%;"><img alt="Pasted image 20231117163957.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117163957.png" style="width: 400px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="12" dir="auto">使用更复杂的互联网络能克服单一、共享式总线的带宽限制</li>
<li data-line="13" dir="auto">图中的纵横式交换机是由 2N 条总线组成的互联网络，交叉点通过交换结构控制器在任何时候能够开启和闭合</li>
<li data-line="14" dir="auto">纵横式交换机是非阻塞的 (non-blocking)，只要没有其他分组当前被转发到该输出端口，转发到输出端口的分组将不会被到达输出端口的分组阻塞，如果来自两个不同输入端口的两个分组其目的地为相同的输出端口，则一个分组必须在输入端等待</li>
</ol>
</li>
</ol>
</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="输出端口处理" dir="auto" class="heading" id="输出端口处理"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输出端口处理</h2><div class="heading-children"><div><p dir="auto"><span alt="Pasted image 20231117171654.png" src="Pasted image 20231117171654.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231117171654.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117171654.png" style="width: 500px; max-width: 100%;"></span></p></div><div><ol dir="auto">
<li data-line="0" dir="auto">输出端口取出已经存放在输出端口内存中的分组并将其发送到输出链路上</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="排队" dir="auto" class="heading" id="排队"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>排队</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">路由器在输入端口和输出端口处都能形成排队</li>
<li data-line="1" dir="auto">排队的位置和程度取决于流量负载、交换结构的相对速率和线路速率</li>
<li data-line="2" dir="auto">当无内存可用于存储到达的分组时会出现丢包 (packet loss)</li>
</ol></div><div class="heading-wrapper"><h3 data-heading="输入排队" dir="auto" class="heading" id="输入排队"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输入排队</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">如果瓶颈在交换结构的吞吐量，那么在输入端口将出现分组排队</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>考虑纵横式结构，假定：
<ol dir="auto">
<li data-line="2" dir="auto">所有链路速度相同</li>
<li data-line="3" dir="auto">一个分组能以一条输入链路接收一个分组所用的时间量，从任意一个输入端口传送到给定的输出端口</li>
<li data-line="4" dir="auto">分组按 FCFS (First Come, First Served) 方式，若有两个分组被发往同一输出队列，其中的一个分组被阻塞</li>
</ol>
</li>
<li data-line="5" dir="auto">线路前部阻塞 (Head-Of-the-Line, HOL) 阻塞：线路前部的另一个分组阻塞，则同一输出队列中排队的分组必须等待前部分组发送后才能发送 <span alt="Pasted image 20231117174816.png" src="Pasted image 20231117174816.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231117174816.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117174816.png" style="width: 500px; max-width: 100%;"></span></li>
</ol></div></div></div><div class="heading-wrapper"><h3 data-heading="输出排队" dir="auto" class="heading" id="输出排队"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>输出排队</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>在缓存已满时，需要做出决定
<ol dir="auto">
<li data-line="1" dir="auto">丢弃到达的分组，采用弃尾 (drop-tail) 的策略</li>
<li data-line="2" dir="auto">删除一个或者多个已排队的分组</li>
</ol>
</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>主动队列管理 (Active Queue Management, AQM) 算法
<ol dir="auto">
<li data-line="4" dir="auto">在缓存填满前丢弃一个分组，可以向发送方提供一个拥塞信号</li>
<li data-line="5" dir="auto">随机早期检测 (Random Early Detection, RED) 是得到最广泛研究和实现的 AQM 算法之一 <span alt="Pasted image 20231117191339.png" src="Pasted image 20231117191339.png" class="internal-embed media-embed image-embed is-loaded" style="width: 300px; max-width: 100%;"><img alt="Pasted image 20231117191339.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231117191339.png" style="width: 300px; max-width: 100%;"></span></li>
</ol>
</li>
<li data-line="6" dir="auto">当分组到达输出端口并排队时，输出端口的分组调度 (packet scheduler) 在排队分组中选择一个分组来传输</li>
<li data-line="7" dir="auto">路由器缓存长度的经验方法：缓存数量 (B) 应当等于平均往返时延 (RTT) 乘以链路的容量 (C)，最近的理论和试验表明，当有大量的 TCP 流 (N 条) 流过一条链路时，缓存所需要的量 <span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D435 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D445 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-msqrt><mjx-sqrt><mjx-surd><mjx-mo class="mjx-n"><mjx-c class="mjx-c221A"></mjx-c></mjx-mo></mjx-surd><mjx-box style="padding-top: 0.214em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-box></mjx-sqrt></mjx-msqrt></mjx-math></mjx-container></span></li>
</ol></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="分组调度" dir="auto" class="heading" id="分组调度"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>分组调度</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>先进先出 (First-In-First-Out, FIFO) <span alt="Pasted image 20231120094352.png" src="Pasted image 20231120094352.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231120094352.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120094352.png" style="width: 500px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="1" dir="auto">如果链路正忙于传输另一个分组，则到达链路输出队列的分组要排队等待传输</li>
<li data-line="2" dir="auto">如果没有足够的缓存来容纳到达的分组，队列的分组丢弃策略确定该分组是否将被丢弃，或者从队列中去除其他分组以便为到达的分组腾出空间</li>
<li data-line="3" dir="auto"><strong>FIFO (FCFS) 调度规则按照分组到达输出链路队列的相同次序来选择分组在链路上的传输</strong><span alt="Pasted image 20231120113103.png" src="Pasted image 20231120113103.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231120113103.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120113103.png"></span></li>
</ol>
</li>
<li data-line="4" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>优先权队列 (priority queuing) <span alt="Pasted image 20231120095614.png" src="Pasted image 20231120095614.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231120095614.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120095614.png" style="width: 500px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="5" dir="auto">到达输出链路的分组被分类放入输出队列中的优先权类</li>
<li data-line="6" dir="auto">优先权排队规则将从<strong>队列为非空的最高优先权类</strong>中传输一个分组</li>
<li data-line="7" dir="auto">在同一优先权类的分组之间的选择通常以 FIFO 方式完成</li>
<li data-line="8" dir="auto">下图使用的规则是非抢占式优先权排队 (non-preemptive priority queuing)，即一旦分组开始传输就不能打断，所以高优先权的分组 4 到达后需要先等待低优先权的分组 2 传输完成 <span alt="" src="Pasted image 20231120115846.png" class="internal-embed media-embed image-embed is-loaded"><img src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120115846.png"></span></li>
</ol>
</li>
<li data-line="9" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>循环加权公平排队
<ol dir="auto">
<li data-line="10" dir="auto">在循环排队规则 (round robin queuing discipline) 下，类之间不存在严格的服务优先权，循环调度器在这些类之间轮流提供服务，下图当传输一个分组传输完成时，调度器查找循环序列中的下一个类<span alt="Pasted image 20231120120805.png" src="Pasted image 20231120120805.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231120120805.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120120805.png"></span></li>
<li data-line="11" dir="auto">保持工作排队 (work-conserving queuing) 规则：有任何类的分组等待传输时，不允许链路保持空闲，当寻找给定类的分组没有找到时，保持工作的循环规则将立即检查循环检查序列中的下一个类</li>
<li data-line="12" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>加权公平排队 (Weight Fair Queuing, WFQ) 规则 <span alt="Pasted image 20231120124017.png" src="Pasted image 20231120124017.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231120124017.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120124017.png" style="width: 500px; max-width: 100%;"></span>
<ol dir="auto">
<li data-line="13" dir="auto">到达的分组被分类并在适合的每个类的等待区域排队</li>
<li data-line="14" dir="auto">WFQ 调度器以循环方式为各个类提供服务</li>
<li data-line="15" dir="auto">WFQ 是一种保持工作排队规则，在发现一个空队列时，调度器立刻移向下一个类</li>
<li data-line="16" dir="auto">WFQ 和循环排队的区别是，每个类在任何时间间隔内可能<strong>收到不同数量</strong>的服务，第 i 类将确保收到的服务部分等于 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-n"><mjx-c class="mjx-c3A3"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D457 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span>，对一条传输速率为 R 的链路，第 i 类能至少获得 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D445 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msub space="3"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-n"><mjx-c class="mjx-c3A3"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D457 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span> 的吞吐量</li>
</ol>
</li>
</ol>
</li>
</ol></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="网际协议" dir="auto" class="heading" id="网际协议">网际协议</h1><div class="heading-children"><div class="heading-wrapper"><h2 data-heading="IPv4 数据报格式" dir="auto" class="heading" id="IPv4_数据报格式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv4 数据报格式</h2><div class="heading-children"><div><p dir="auto"><span alt="Pasted image 20231120141624.png" src="Pasted image 20231120141624.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231120141624.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120141624.png" style="width: 500px; max-width: 100%;"></span> <span alt="Pasted image 20231120142719.png" src="Pasted image 20231120142719.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231120142719.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120142719.png"></span></p></div><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv4 的数据报格式如图
<ol dir="auto">
<li data-line="1" dir="auto"><code>版本</code>：4 比特，规定 IP 协议版本，IPv4 的版本号为 <code>0100</code>，IPv6 的版本号为 <code>0110</code>，通过查看版本号，路由器能确定如何解释 IP 数据报的剩余部分</li>
<li data-line="2" dir="auto"><code>首部长度</code>：4 比特，指定 IP 数据报首部长度，由于确定载荷的起始点，一般的 IPv4 数据报具有 20 字节的首部</li>
<li data-line="3" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>区分服务 (Differentiated Services, DS)</code>：区分不同类型的 IP 数据报, 从而便于现代网络提供 Qos (quality of service)，IPv4 中前 6 位为区分服务代码点 (Differentiated Services Code Point，DSCP) [@DifferentiatedServices2023]，后 2 位被用于<a data-tooltip-position="top" aria-label="运输层 > 网络辅助拥塞控制" data-href="运输层#网络辅助拥塞控制" href="campus/chinese-notes/计算机科学/计算机网络/运输层.html#网络辅助拥塞控制" class="internal-link" target="_self" rel="noopener">显示拥塞通知 (Explicit Congestion Notification, ECN)</a>  
<ol dir="auto">
<li data-line="4" dir="auto">DSCP</li>
<li data-line="5" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ECN
<ol dir="auto">
<li data-line="6" dir="auto"><code>ECN-Capable Transport (ECT)</code>: 如果位 6 被设置，表明此数据报的传输已经做好拥塞遭遇的准备，也就是说，它可以承受网络中的拥塞而不需要丢弃数据报</li>
<li data-line="7" dir="auto"><code>Congestion Experienced (CE) </code>: 如果位 7 被设置，表明在网络路径中已经遇到拥塞，需要减少发送速率</li>
</ol>
</li>
</ol>
</li>
<li data-line="8" dir="auto"><code>数据报长度</code>：IP 数据报的总长度 (首部加上数据)，数据报长度字段的设计考虑到了以太网帧的最大传输单元  (MTU)，该长度确保一个 IP 数据报可以作为数据字段（也就是载荷）被完整地封装在一个以太网帧内部进行传输</li>
<li data-line="9" dir="auto"><code>标识(Identification)、标志(Flags)、片偏移(Fragment Offset)</code>：与 <a data-tooltip-position="top" aria-label="网络层-数据平面 > IPv4 数据报分片" data-href="网络层-数据平面#IPv4 数据报分片" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv4_数据报分片" class="internal-link" target="_self" rel="noopener">IP 分片</a> 相关</li>
<li data-line="10" dir="auto"><code>寿命(Time-To-Live, TTL)</code>：确保数据报不会永远在网络中循环，每当一台路由器处理数据报时 TTL 减一，若 TTL 为 0，则该数据报必须丢弃</li>
<li data-line="11" dir="auto"><code>协议</code>：指示了 IP 数据报的数据部分应该交给哪个特定的运输层协议，可能值详见 <a data-tooltip-position="top" aria-label="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml" rel="noopener" class="external-link" href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml" target="_blank">IANA Protocol Numbers</a> ，协议号将网络层与运输层绑定到一起 </li>
<li data-line="12" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>首部检验和</code>：计算方法同 <a data-href="运输层#检验和计算过程" href="campus/chinese-notes/计算机科学/计算机网络/运输层.html#检验和计算过程" class="internal-link" target="_self" rel="noopener">运输层 &gt; 检验和计算过程</a> ，因为每经过一台路由器 TTL 字段会改变，所以每台路由器上必须重新计算检验和并放回原处
<ol dir="auto">
<li data-line="13" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>为什么运输层和网络层都执行差错检测？
<ol dir="auto">
<li data-line="14" dir="auto">首先 IP 层只对 IP 首部计算检验和，而 TCP / UDP 是对整个报文段计算</li>
<li data-line="15" dir="auto">TCP / UDP 与 IP 不一定必须运行在同一个协议栈上</li>
</ol>
</li>
</ol>
</li>
<li data-line="16" dir="auto"><code>源和目的IP地址</code>：通常源主机通过 DNS 查找来决定目的地址</li>
<li data-line="17" dir="auto"><code>选项</code>：选项字段允许 IP 首部被扩展，IPv6 首部已经删除选项字段</li>
<li data-line="18" dir="auto"><code>数据(有效载荷)</code>：包含要交付给目的地的 <a data-tooltip-position="top" aria-label="运输层 > ^e40540" data-href="运输层#^e40540" href="campus/chinese-notes/计算机科学/计算机网络/运输层.html#^e40540" class="internal-link" target="_self" rel="noopener">运输层报文段</a>，也可承载如 ICMP 报文等数据</li>
</ol>
</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="IPv4 数据报分片" dir="auto" class="heading" id="IPv4_数据报分片"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv4 数据报分片</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">一个链路层帧能承载的最大数据量叫作最大传送单元 (Maximum Transmission Unit, MTU)，故 MTU 严格限制 IP 数据报的长度</li>
<li data-line="1" dir="auto">发送方与目的地路径上的每段链路可能使用不同的链路层协议，每段协议可能具有不同的 MTU</li>
<li data-line="2" dir="auto">当出链路的 MTU 比入链路小时，需要将 IP 数据报中的数据分片成两个或多个较小的 IP 数据报，用单独的链路层帧封装这些数据报(这些数据报被称为片, fragment)，再通过输出链路发送这些帧</li>
<li data-line="3" dir="auto">坚持网络核心保持简单的原则，IPv4 设计者决定将数据报重新组装的工作放到端系统中</li>
<li data-line="4" dir="auto">目的主机收到一系列数据报时，需要确定数据报中的某些是否是一些原来较大的数据报的片，如果是的话需要将这些片重新组装成数据报</li>
<li data-line="5" dir="auto">IP 是不可靠服务，源主机发送的不同数据报具有不同的 <code>标识号</code>，分片后通过 <code>偏移字段</code> 指定该片放在初始 IP 数据报的哪个位置，并将最后一个片的 <code>标志</code> 比特设置为 0 ，其他片的 <code>标志</code> 比特设置为 1</li>
<li data-line="6" dir="auto">图中 4000 字节的数据报到达路由器需要被转发到一条 MTU = 1500B 的链路上，初始数据报中 3980 字节数据必须被分配为 3 个独立的片 <span alt="Pasted image 20231120162427.png" src="Pasted image 20231120162427.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231120162427.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120162427.png" style="width: 500px; max-width: 100%;"></span></li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="IPv4 编址" dir="auto" class="heading" id="IPv4_编址"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv4 编址</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">接口 (interface)：主机与物理链路之间的边界</li>
<li data-line="1" dir="auto">路由器的任务是从链路上接收数据报并从某些其他链路转发出去，路由器必须拥有两条或更多条链路与它连接</li>
<li data-line="2" dir="auto">一个 IP 地址与一个接口相关联，而不是与包括该接口的主机或路由器相关联</li>
<li data-line="3" dir="auto">IPv4 地址通常用<strong>点分十进制记法 (dotted-decimal notation)</strong> 书写</li>
<li data-line="4" dir="auto">除了在 NAT 后的接口外，全球因特网中的每台主机和路由器的每个接口，都必须有一个全球唯一的 IP 地址</li>
<li data-line="5" dir="auto">图中的 223.1.1 开头的接口通过一台以太网交换机或一个无限接入点互联，形成一个字网 (subnet)，<code>223.1.1.0/24</code> 的左侧 24 比特定义了子网地址，<code>/24</code> 为子网掩码，任何连接到该子网的主机都需要具有 <code>223.1.1.xxx</code> 形式  <span alt="Pasted image 20231120163855.png" src="Pasted image 20231120163855.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20231120163855.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120163855.png" style="width: 700px; max-width: 100%;"></span></li>
<li data-line="6" dir="auto">定义子网的方法：为了确定子网，分开主机和路由器的每个接口，产生几个隔离的网络岛，使用接口端接这些隔离的网络的端点，这些隔离的网络中的每一个都叫作一个子网 (subnet)</li>
<li data-line="7" dir="auto">下图有 6 个子网，分别是 <code>223.1.1.0/24</code> <code>223.1.2.0/24</code> <code>223.1.3.0/24</code> <code>223.1.9.0/24</code> <code>223.1.8.0/24</code> <code>223.1.7.0/24</code> <span alt="Pasted image 20231120165446.png" src="Pasted image 20231120165446.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20231120165446.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120165446.png" style="width: 700px; max-width: 100%;"></span></li>
<li data-line="8" dir="auto">无类别域间路由选择 (Classless Interdomain Routing, CIDR)：形式为 <code>a.b.c.d/x</code> 的地址的最高比特构成了 IP 地址的网络部分，并且经常被称为该地址的前缀 ( prefix ) (或网络前缀)，一个地址的剩余 <code>32 - x</code> 比特可用于区分该组织内部设备，该组织的内部结构可以采用同样的方式划分子网 </li>
<li data-line="9" dir="auto">地址聚合 (address aggregation) / 路由聚合 (route aggregation) / 路由摘要 (route summarization)：使用单个网络前缀通告多个网络的能力 <span alt="Pasted image 20231120172624.png" src="Pasted image 20231120172624.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20231120172624.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120172624.png" style="width: 700px; max-width: 100%;"></span></li>
<li data-line="10" dir="auto"><a data-tooltip-position="top" aria-label="网络层-数据平面 > ^189d26" data-href="网络层-数据平面#^189d26" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#^189d26" class="internal-link" target="_self" rel="noopener">最长前缀匹配</a>：当组织 1 <code>200.23.18.0/23</code> 换用 ISPs-R-Us 的服务时，Fly-By-Night-ISP 继续通告原来的地址块，ISPs-R-Us 增加通告 <code>200.23.18.0/23</code>，当其他路由器看见 <code>200.23.16.0/20</code> 和 <code>200.23.18.0/23</code> 时，根据最长前缀匹配向 ISPs-R-Us 路由 <span alt="Pasted image 20231120172644.png" src="Pasted image 20231120172644.png" class="internal-embed media-embed image-embed is-loaded" style="width: 700px; max-width: 100%;"><img alt="Pasted image 20231120172644.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231120172644.png" style="width: 700px; max-width: 100%;"></span></li>
<li data-line="11" dir="auto">分类编址 (classful addressing)：具有 8、16 或 24 比特子网地址的子网被分别被称为 A、B 和 C 类网络，分别可容纳 16777214、65534、254 (两个预留地址)台设备</li>
<li data-line="12" dir="auto">IP 广播地址：主机发送目的地址为 <code>255.255.255.255</code> 的数据报时，报文会交付给同一个网络中的所有主机，路由器也会有选择地向邻近的子网转发该报文</li>
</ol></div><div class="heading-wrapper"><h3 data-heading="获取一块地址" dir="auto" class="heading" id="获取一块地址"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>获取一块地址</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">IP 地址由因特网名字和编号分配机构 (Internet Corporation for Assigned Names and Numbers, ICANN)管理，ICANN 向区域性因特网注册机构分配地址</li>
<li data-line="1" dir="auto">ICANN 还管理 DNS 根服务器，同时负责分配域名和解决域名纠纷</li>
</ol></div></div></div><div class="heading-wrapper"><h3 data-heading="DHCP [@DynamicHostConfiguration2023]" dir="auto" class="heading" id="DHCP_[@DynamicHostConfiguration2023]"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>DHCP [@DynamicHostConfiguration2023]</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">动态主机配置协议 (Dynamic Host Configuration, DHCP) 允许主机自动获取一个 IP 地址，网络管理员能配置 DHCP 以使主机每次与网络连接时能得到一个相同的 IP 地址，或者分配一个临时的 IP 地址 (temporary IP address)，DHCP 还允许主机得知其他信息，例如子网掩码、默认网关和本地 DNS 地址 <span alt="Pasted image 20231121102137.png" src="Pasted image 20231121102137.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121102137.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121102137.png"></span></li>
<li data-line="1" dir="auto">DHCP 又被称为即插即用协议 (plug-and-play protocol) 或零配置协议 (zeroconf)</li>
<li data-line="2" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>DHCP 协议的步骤如图 <span alt="Pasted image 20231121105930.png" src="Pasted image 20231121105930.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121105930.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121105930.png"></span>
<ol dir="auto">
<li data-line="3" dir="auto"><code>DHCP服务器发现</code>：新主机使用 DHCP 发现报文 (DHCP discover message)，通过向 subnet 广播封装了 UDP 分组 (67 端口) 的 IP 数据报 (源 IP <code>0.0.0.0</code> 本主机，目的 IP <code>255.255.255.255</code> 广播地址)，让 DHCP 服务器接收到报文</li>
<li data-line="4" dir="auto"><code>DHCP服务器提供</code>：服务器用 DHCP 提供报文做出响应该报文仍然使用 IP 广播地址 <code>255.255.255.255</code>，提供报文中包含推荐的 IP 地址、网络掩码以及 IP 地址租用期 (address lease time) <span alt="Pasted image 20231121111831.png" src="Pasted image 20231121111831.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121111831.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121111831.png"></span></li>
<li data-line="5" dir="auto"><code>DHCP请求</code>：客户从一个或多个服务器选择一个，并向选中的服务器提供 DHCP 请求报文 (DHCP request message)，回显配置的参数</li>
<li data-line="6" dir="auto"><code>DHCP ACK</code>：服务器用 DHCP ACK 报文 (DHCP ACK message) 对 DHCP 请求报文进行响应</li>
</ol>
</li>
<li data-line="7" dir="auto">DHCP 客户端状态转移图 <span alt="Pasted image 20231121112842.png" src="Pasted image 20231121112842.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121112842.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121112842.png"></span></li>
<li data-line="8" dir="auto">DHCP 客户端的缺陷是移动节点在子网之间移动时，不能维持与远程应用之间的 TCP 连接</li>
</ol></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="NAT" dir="auto" class="heading" id="NAT"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>NAT</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">网络地址转换 (Network Address Translation, NAT) 通常用于 SOHO (Small Office, Home Office) 中设备过多的 IP 地址不够分配的情况</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>RFC 1918 [@moskowitzAddressAllocationPrivate1996] 定义了以下 IP 地址块，用于专用网络 (private network) 和具有<strong>专用地址的地域</strong>的地址空间：
<ol dir="auto">
<li data-line="2" dir="auto"><code>10.0.0.0/8</code></li>
<li data-line="3" dir="auto"><code>172.16.0.0/12</code></li>
<li data-line="4" dir="auto"><code>192.168.0.0/16</code></li>
</ol>
</li>
<li data-line="5" dir="auto">具有专用地址的地域 (realm with private address)：其地址仅对该网络中的设备有意义的网络</li>
<li data-line="6" dir="auto">家庭网络计算机从 DHCP 服务器得到 IP 地址</li>
<li data-line="7" dir="auto">NAT 路由器维护一张 NAT 转换表 (NAT translation table)，当生成一个新的源端口号时，NAT 路由器选择任意一个当前未在 NAT 转换表中的源端口号，并在 NAT 转换表中增加一个表项 <span alt="Pasted image 20231121145854.png" src="Pasted image 20231121145854.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121145854.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121145854.png"></span></li>
<li data-line="8" dir="auto">NAT 的使用对于运行在家庭网络的服务器会引起问题 (P2P 对等方)，解决方案包括 NAT 穿越 (NAT traversal) 和通用即插即用 (Universal Plug and Play, UPnP[@UniversalPlugPlay2023])</li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="IPv6" dir="auto" class="heading" id="IPv6"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv6</h2><div class="heading-children"><div><p dir="auto"><span alt="Pasted image 20231121155011.png" src="Pasted image 20231121155011.png" class="internal-embed media-embed image-embed is-loaded" style="width: 500px; max-width: 100%;"><img alt="Pasted image 20231121155011.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121155011.png" style="width: 500px; max-width: 100%;"></span><span alt="Pasted image 20231121161020.png" src="Pasted image 20231121161020.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121161020.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121161020.png"></span></p></div><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv6 数据报格式如图 <span alt="dee20d12ebabfb65621128b578bb6a6f.png" src="dee20d12ebabfb65621128b578bb6a6f.png" class="internal-embed media-embed image-embed is-loaded"><img alt="dee20d12ebabfb65621128b578bb6a6f.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/dee20d12ebabfb65621128b578bb6a6f.png"></span>
<ol dir="auto">
<li data-line="1" dir="auto"><code>版本</code>：用于标识 IP 版本号</li>
<li data-line="2" dir="auto"><code>流量类型</code>：与 <a data-tooltip-position="top" aria-label="网络层-数据平面 > ^11e8fd" data-href="网络层-数据平面#^11e8fd" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#^11e8fd" class="internal-link" target="_self" rel="noopener">区分服务</a> 类似</li>
<li data-line="3" dir="auto"><code>流标签</code>：用于标识一条数据报的流，能够对一条流中的某些数据报给出优先权</li>
<li data-line="4" dir="auto"><code>有效载荷长度</code>：数据字段的字节数量</li>
<li data-line="5" dir="auto"><code>下一个首部</code>：与 <a data-tooltip-position="top" aria-label="网络层-数据平面 > ^af7241" data-href="网络层-数据平面#^af7241" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#^af7241" class="internal-link" target="_self" rel="noopener">IPv4 协议字段</a>相似</li>
<li data-line="6" dir="auto"><code>跳限制</code>：转发数据报的每台路由器将该字段的内容减 1，若值为 0 则该数据报被丢弃</li>
<li data-line="7" dir="auto"><code>源地址和目的地址</code>：IPv6 地址的格式见 RFC 4291 [@deeringIPVersionAddressing2006]</li>
<li data-line="8" dir="auto"><code>数据</code>：IPv6 数据报的有效载荷部分</li>
</ol>
</li>
<li data-line="9" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>相较于 IPv 4 已经不存在的字段
<ol dir="auto">
<li data-line="10" dir="auto"><code>分组/重新组装</code>：IPv6 不允许在中间路由器上分片和组装，过大的数据报会被丢弃并回送一个 ICMP 报文</li>
<li data-line="11" dir="auto"><code>首部检验和</code>：快速处理 IP 分组是关注的重点，由于运输层和数据链路层执行了检验操作，所以设计者将 IP 中的冗余字段去除</li>
<li data-line="12" dir="auto"><code>选项</code>：现在选项字段出现在<strong>下一个首部</strong>指出的位置上</li>
</ol>
</li>
</ol></div><div class="heading-wrapper"><h3 data-heading="IPv4 到 IPv6 的迁移" dir="auto" class="heading" id="IPv4_到_IPv6_的迁移"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>IPv4 到 IPv6 的迁移</h3><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">建隧道 (Tunneling) ：隧道发送端的 IPv6 节点将整个 IPv6 数据报放到一个 IPv4 数据报的数据 (有效载荷) 字段中，隧道接收端 IPv6 节点查看协议字段指示 IPv6，从 IPv4 数据报中取出 IPv6 数据报并提供路由<span alt="Pasted image 20231121172718.png" src="Pasted image 20231121172718.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231121172718.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231121172718.png"></span></li>
<li data-line="1" dir="auto">隧道 (tunnel)：两台 IPv6 路由器之间的中间 IPv4 路由器的集合</li>
</ol></div></div></div></div></div></div></div><div class="heading-wrapper"><h1 data-heading="通用转发和 SDN" dir="auto" class="heading" id="通用转发和_SDN">通用转发和 SDN</h1><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">A middlebox is&nbsp;<strong>a computer networking device that transforms, inspects, filters, and manipulates traffic for purposes other than packet forwarding</strong> </li>
<li data-line="1" dir="auto">网络层基于目的地转发的特征：查找目的 IP 地址 (匹配)，将分组发送到有特定输出端口的交换结构 (动作)</li>
<li data-line="2" dir="auto">考虑一种通用"匹配加动作"范式 (不局限于 Layer 3)，对协议栈的多个首部字段匹配，并采取相应的动作，包括将分组转发到一个或多个输出端口 (就像在基于目的地转发中一样)，跨越多个通向服务的离开接口进行负载均衡分组 (就像在负载均衡中一样)，重写首部值 (就像在 NAT 中一样)，有意识地阻挡／丢弃某个分组 (就像在防火墙中一样)，为进一步处理和动作而向某个特定的服务器发送一个分组 (就像在 DPI 一样)，等等 </li>
<li data-line="3" dir="auto">由于通用转发中匹配加动作表将基于目的地的转发表一般化，所以<strong>既包括网络层又包括链路层的转发</strong>决定，所以用 <a data-tooltip-position="top" aria-label="因特网 > 分组交换机(packet switch)" data-href="因特网#分组交换机(packet switch)" href="campus/chinese-notes/计算机科学/计算机网络/因特网.html#分组交换机(packet_switch)" class="internal-link" target="_self" rel="noopener">分组交换机</a> 统称 SDN 转发设备<span alt="Pasted image 20231122105823.png" src="Pasted image 20231122105823.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231122105823.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231122105823.png"></span></li>
<li data-line="4" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>本节将基于 OpenFlow 标准对通用转发进行讨论
<ol dir="auto">
<li data-line="5" dir="auto">OpenFlow 1.0 引入了关键的 SDN 抽象和功能</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>匹配加动作转发表在 OpenFlow 中称为流表 (flow table)，表项包括
<ol dir="auto">
<li data-line="7" dir="auto"><code>首部字段值的集合</code>：基于硬件匹配在 <a data-tooltip-position="top" aria-label="网络层-数据平面 > ^c49453" data-href="网络层-数据平面#^c49453" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#^c49453" class="internal-link" target="_self" rel="noopener">TCAM</a> 内存中执行最迅速</li>
<li data-line="8" dir="auto"><code>计数器集合</code></li>
<li data-line="9" dir="auto"><code>所采取的动作集合</code></li>
</ol>
</li>
</ol>
</li>
</ol></div><div class="heading-wrapper"><h2 data-heading="匹配" dir="auto" class="heading" id="匹配"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>匹配</h2><div class="heading-children"><div><p dir="auto"><span alt="Pasted image 20231122105353.png" src="Pasted image 20231122105353.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20231122105353.png" src="campus/chinese-notes/计算机科学/计算机网络/attachments/pasted-image-20231122105353.png"></span></p></div><div><ol dir="auto">
<li data-line="0" dir="auto"><code>入端口</code>：分组交换机上接收分组的输入端口</li>
<li data-line="1" dir="auto">OpenFlow 不允许基于 TTL 字段或数据报长度字段的匹配</li>
<li data-line="2" dir="auto">抽象的艺术：<strong>在一个时刻做一件事，将它做好。一个接口应当俘获一个抽象的最低限度的要件。不要进行一般化，一般化通常是错误的</strong></li>
</ol></div></div></div><div class="heading-wrapper"><h2 data-heading="动作" dir="auto" class="heading" id="动作"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>动作</h2><div class="heading-children"><div><ol dir="auto">
<li data-line="0" dir="auto">每个流表项都有零个或多个动作列表</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>作为重要的动作可能是：
<ol dir="auto">
<li data-line="2" dir="auto"><code>转发</code>：一个分组可能被单播广播或多播到输出端口，也可能被封装并发送到远程控制器，控制器可能对该分组采取某些动作，包括安装新的流表项，以及可能在该分组返回给该设备以在更新的流表规则集合下进行转发</li>
<li data-line="3" dir="auto"><code>丢弃</code>：没有动作的流表项表明匹配的分组应当被丢弃</li>
<li data-line="4" dir="auto"><code>修改字段</code>：分组被转发到输出端口前，分组首部除了 IP 协议的 Layer 2.3.4 字段可重写</li>
</ol>
</li>
</ol></div><div class="mod-footer"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#网络层概述"><div class="tree-item-contents heading-link" heading-name="网络层概述"><span class="tree-item-title">网络层概述</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#转发和路由选择:数据平面和控制平面"><div class="tree-item-contents heading-link" heading-name="转发和路由选择:数据平面和控制平面"><span class="tree-item-title">转发和路由选择:数据平面和控制平面</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#网络服务模型"><div class="tree-item-contents heading-link" heading-name="网络服务模型"><span class="tree-item-title">网络服务模型</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#路由器工作原理"><div class="tree-item-contents heading-link" heading-name="路由器工作原理"><span class="tree-item-title">路由器工作原理</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#输入端口处理和基于目的地转发"><div class="tree-item-contents heading-link" heading-name="输入端口处理和基于目的地转发"><span class="tree-item-title">输入端口处理和基于目的地转发</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#交换"><div class="tree-item-contents heading-link" heading-name="交换"><span class="tree-item-title">交换</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#输出端口处理"><div class="tree-item-contents heading-link" heading-name="输出端口处理"><span class="tree-item-title">输出端口处理</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#排队"><div class="tree-item-contents heading-link" heading-name="排队"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">排队</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#输入排队"><div class="tree-item-contents heading-link" heading-name="输入排队"><span class="tree-item-title">输入排队</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#输出排队"><div class="tree-item-contents heading-link" heading-name="输出排队"><span class="tree-item-title">输出排队</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#分组调度"><div class="tree-item-contents heading-link" heading-name="分组调度"><span class="tree-item-title">分组调度</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#网际协议"><div class="tree-item-contents heading-link" heading-name="网际协议"><span class="tree-item-title">网际协议</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv4_数据报格式"><div class="tree-item-contents heading-link" heading-name="IPv4 数据报格式"><span class="tree-item-title">IPv4 数据报格式</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv4_数据报分片"><div class="tree-item-contents heading-link" heading-name="IPv4 数据报分片"><span class="tree-item-title">IPv4 数据报分片</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv4_编址"><div class="tree-item-contents heading-link" heading-name="IPv4 编址"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">IPv4 编址</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#获取一块地址"><div class="tree-item-contents heading-link" heading-name="获取一块地址"><span class="tree-item-title">获取一块地址</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#DHCP_[@DynamicHostConfiguration2023]"><div class="tree-item-contents heading-link" heading-name="DHCP [@DynamicHostConfiguration2023]"><span class="tree-item-title">DHCP [@DynamicHostConfiguration2023]</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#NAT"><div class="tree-item-contents heading-link" heading-name="NAT"><span class="tree-item-title">NAT</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv6"><div class="tree-item-contents heading-link" heading-name="IPv6"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">IPv6</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#IPv4_到_IPv6_的迁移"><div class="tree-item-contents heading-link" heading-name="IPv4 到 IPv6 的迁移"><span class="tree-item-title">IPv4 到 IPv6 的迁移</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#通用转发和_SDN"><div class="tree-item-contents heading-link" heading-name="通用转发和 SDN"><span class="tree-item-title">通用转发和 SDN</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#匹配"><div class="tree-item-contents heading-link" heading-name="匹配"><span class="tree-item-title">匹配</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="campus/chinese-notes/计算机科学/计算机网络/网络层-数据平面.html#动作"><div class="tree-item-contents heading-link" heading-name="动作"><span class="tree-item-title">动作</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>