## 网络层概述

1. 网络层的分解
      - 数据平面
      - 控制平面

2. 数据平面功能:网络中每台路由器的功能，决定到达路由器输入链路之一的数据报如何转发到该路由器的输出链路之一
3. 控制平面功能:网络范围的逻辑，控制数据报沿着从源主机沿着到目的主机的端到端路径中路由器的路由方式
4. 软件定义网络(Software-Defined Networking, SDN):将控制平面功能作为一种单独服务，明确地分离数据平面和控制平面

### 转发和路由选择:数据平面和控制平面
1. 转发(forwarding):将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作
      - 数据平面中实现的唯一功能
      - 分组有可能被现有的路由器阻挡也有可能冗余的经过多条链路发送

2. 路由选择(routing):确定分组从源到目的地所采取的端到端路径的网络范围处理过程，通常用软件来实现
      - 路由选择算法(routing algorithm):计算分组从发送方流向接收方时采用的路由或路径
      - 在控制平面中实现
3. 转发表(forwarding table):路由器检查到达分组首部的一个或多个字段值，进而使用这些首部值在其转发表中索引
4. 转发表的配置
      - 控制平面:传统方法
        - 路由选择算法决定了插入路由器转发表的内容，在一台路由器中的路由选择算法与其他路由器重的算法通信，计算出转发表的值
      - 控制平面:SDN方法
        - 路由选择设备仅执行转发，而远程控制器计算并分发转发表

### 网络服务模型
1. 网络服务模型(network service model)定义了分组在发送和接收端系统之间的端到端运输特性
2. 尽力而为服务(best-effort service):因特网网络层提供的单一服务，传送的分组既不能保证以发送的顺序被接收，也不能保证最终交付，既不能保证端到端时延，也不能保证有最小的带宽
3. 分组交换机:通用分组交换设备
      - 链路层交换机(link-layer switch):基于链路层帧中的字段值做出转发决定
      - 路由器(router):基于网络数据报中的首部字段值做出转发决定

## 路由器工作原理
1. 路由器组件
      - 输入端口(input port)
        - 终结入物理链路的物理层功能
        - 与位于远端的数据链路层交互来执行数据链路层功能
        - 查询转发表决定路由器的输出端口
        - 控制分组从输入端口(指物理IO接口，与软件端口不同)转发到路由选择处理器
      - 交换结构:将路由器的输入端口连接到输出端口，这种交换结构时网络路由器中的网络
      - 输出端口:存储从交换结构接收的分组，通过执行必要的链路层和物理层功能在输出链路上传输这些分组(双向链路输出端口总是和输入端口成对出现在同一线路卡上)
      - 路由选择处理器:执行控制平面功能，
        - 传统路由器:执行路由选择协议，维护路由选择表与关联链路状态信息
        - SDN路由器:负责与远端控制器通信，接收由远程控制器计算的转发表项

### 输入端口处理和基于目的地转发
1. 转发表从路由选择处理器经过独立总线复制到线路卡
2. 使用每个输入端口的影子副本，转发决策可在每个输入端口本地做出，避免了集中式处理瓶颈
3. 路由器通过前缀(prefix)匹配来转发分组，当有多个匹配时使用最长前缀匹配规则(longest prefix matching rule)
4. 在吉比特速率下，查找转发表必须在纳秒级执行，需要对大型转发表使用超出简单线性搜索的技术，实践中常用三态内容可寻址存储器(Tenary Content Address Memory, TCAM)来查找
5. 阻塞的分组需要在输入端口处排队
6. 输入端口除了转发仍需要处理的事情
      - 物理层和链路层处理
      - 检查分组的版本号、检验和以及寿命字段，并重写最后两个字段
      - 更新用于网络管理的计数器

### 交换
1. 路由器通过交换结构使分组实际地从一个输入端口交换到另一个输出端口中
2. 交换可以用许多方式完成