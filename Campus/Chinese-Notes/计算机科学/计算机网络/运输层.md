# 概述和运输层服务
1. 逻辑通信 (logic communication)：
	1. 运输层协议为运行在不同主机的运用进程之间提供了逻辑通信功能
	2. 通过逻辑通信，运行不同进程的主机好像直接相连一样
2. 运输层协议在端系统中实现，发送端运输层将从发送应用程序进程接收到的报文转换成运输层报文段 (segment)，网路层将其封装成网络层分组（即数据报）并向目的地发送，接收端，网络层从数据报中提取运输层报文段，并将该报文段向上交给运输层 ![[Pasted image 20231107111221.png]]
3. 网络层提供了主机之间的逻辑通信，运输层为运行在不同主机上的进程之间提供了逻辑通信
## 因特网运输层概述
1. 因特网为应用层提供了 UDP (用户数据报协议) 和 TCP (传输控制协议)
	1. UDP 为调用它的应用程序提供了一种不可靠、无连接的服务
	2. TCP 为调用它的应用程序提供了一种可靠的、面向连接的服务
2. 网际协议 (Internet Protocol)：网络层协议，为主机之间提供了逻辑通信
	1. 服务模型：尽力而为交付服务 (best-effort delivery service)，不确保报文段的交付，不保证报文段的按序交付，不保证报文段中数据的完整性
	2. 不可靠服务 (unreliable service)
	3. 每台主机至少有一个网络层地址
3. TCP 和 UDP 提供的服务模型：进程到进程的数据交付和差错检查 ![[IMG_6734.jpeg|600]]
	1. 将主机间交付拓展到进程间交付，运输层的多路复用 (transport-layer multiplexing) 和多路分解 (demultiplexing)
	2. 通过在其报文段首部中包括差错检查字段而提供完整性检查
4. TCP 提供的附加服务
	1. 可靠数据传输 (reliable data transfer)：通过流量控制、序号、确认和定时器，确保正确地、按序地将数据从发送进程交付给接收进程
	2. 拥塞控制 (congestion control)：力求为每个通过一条拥塞网络链路的连接平等地共享网络链路带宽
# 多路复用与多路分解
1. 运输层没有直接将数据交付给进程，而是将数据交给了中间的套接字，每个套接字都有唯一的标识符 (端口号)
2. 多路分解 (demultiplexing)：将运输层报文段中的数据交付到正确的套接字
3. 多路复用 (multiplexing)：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息（这将在以后用于分解）从而生成报文段，然后将报文段传递到网络层
4. 运输层报文段组成 ![[Pasted image 20231107151302.png]] ![[Pasted image 20231107151326.png|300]]
	1. 周知端口号 (well-known port number)：0～1023，保留给周知应用层协议使用 [RFC 3232]()
	2. 如果编写的代码实现的是一个周知协议的服务器端，就需要分配一个相应的周知端口号，通常应用程序的客户端让运输层自动地 (并且是透明地) 分配端口号，而服务器端则分配一个特定的端口号
### 无连接的多路复用与多路分解
1. UDP 套接字是由一个二元组全面标识的(一个目的 IP 地址和一个目的端口号)
2. 如果两个 UDP 报文段有不同的源 IP 地址和 / 或源端口号，但具有相同的目的 IP 地址和目的端口号，那么这两个报文段将通过相同的目的套接字被定向到相同的目的进程
3. 原端口号用作"返回地址"的一部分，在回发报文段时提取原端口号作为目的端口号
### 面向连接的多路复用和多路分解
1. TCP 套接字是由一个四元组(源 IP 地址，源端口号，目的 IP 地址，目的端口号)来标识的
2. 两个具有不同源 IP 地址或源端口号的到达 TCP 报文段将被定向到两个不同的套接字，除非 TCP 报文段携带了初始创建连接的请求 ![[Pasted image 20231107164127.png]]
3. 对于服务器，在任意给定的时间内都可能有（具有不同标识的）许多连接套接字连接到相同的进程，服务器可以采用多种并发模型来处理多个连接，例如：
	◦	多进程模型（Forking）：对每个新连接，服务器可以 fork 一个新的进程来处理该连接。
	◦	多线程模型（Threading）：服务器可以为每个新连接创建一个新的线程。
	◦	事件驱动模型（Event-driven）：服务器使用非阻塞 IO 和事件循环，通过一个单独的进程或线程来管理所有连接。
	◦	异步 IO 模型：服务器利用操作系统提供的异步 IO 接口进行非阻塞 IO 操作，而不需要每个连接一个线程。
# 无连接运输：UDP
1. 应用程序更适合 UDP 的原因：
	1. 关于发送什么数据以及何时发送的应用层控制更为精细
	2. 无需连接建立：QUlC 协议（快速 UDP 因特网连接) 将 UDP 作为其支撑运输协议并在 UDP 之上的应用层协议中实现可靠性
	3. 无连接状态
	4. 分组首部开销小
2. 网络管理应用程序通常必须在该网络处于重压状态时运行，所以在这种场合下 UDP 要优于 TCP
3. UDP 中缺乏拥塞控制能够导致 UDP 发送方和接收方之间的高丢包率，并挤垮了 TCP 会话
4. 使用 UDP 的应用是可能实现可靠数据传输的 (eg. QUIC)
## UDP 报文段结构
