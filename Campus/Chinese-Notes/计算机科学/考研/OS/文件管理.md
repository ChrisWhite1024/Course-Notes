## 属性
1. 文件名：同一目录下不允许有重名文件
2. 标识符：用于唯一确定文件
3. 类型：指明文件的类型
4. 位置：文件的存放路径、外存中的地址
5. 大小：指明文件大小
6. 保护信息
## 数据组织
1. 无结构文件：由一系列二进制或字符流组成
2. 有结构文件：考虑文件的逻辑结构
## 操作系统提供的功能
1. 创建文件：create
2. 删除文件：delete
3. 读文件： read 
4. 写文件：write
5. 打开文件：open
6. 关闭文件：close
7. 文件共享
8. 文件保护
# 逻辑结构
1. 在用户看来，文件内部的数据是怎样组织起来的
## 无结构文件
1. 由字符流构成的文件，又称流式文件
2. 在用户看来，文件占用一片连续的逻辑地址空间
```c
FILE *fp = fopen("test.txt", "w");
if (fp == NULL) {
	printf("open file error");
	exit(0);
}
for (int i = 0; i < 10000; i++)
	fputs("Hello world!", fp);
fclose(fp);
```
## 有结构文件
1. 由一组相似的记录组成，又称"记录式文件"。每条记录又由若干个数据项组成，根据记录的长度，又可分为定长记录和可变长记录
### 顺序文件
1. 串结构：记录之间的顺序与关键字无关
2. 顺序结构：记录之间的顺序按关键字顺序排列
3. 链式存储无法实现随机存取，只能从第一个记录开始一次往后找
4. 顺序存储的文件，如果是可变长的则无法实现随机存取
5. 定长记录若采用顺序结构，可以快速找到某关键字对应的记录
6. 考试中指的顺序文件是物理上顺序存储的顺序文件
7. 顺序文件的缺点是增加/删除一个记录比较困难
```c
typedef struct {
	int number;
	char name[30];
	char major[30];
} StudentInfo

FIEL *fp = fopen("students.info", "w");
if (fp == NULL) {
	printf("file open error");
	exit(0);
}

StudentInfo student[N];
for (int i = 0; i < N; i++) {
	student[i].number = i;
	stduent[i].name[0] = '?';
	stduent[i].major[0] = '?';
}

fwrite(student, sizeof(StudentInfo), N, fp);
fclose(fp);
```

### 索引文件
1. 解决可变长记录查找速度慢的问题
2. 建立一张索引表加快文件检索速度
3. 索引表本身是定长记录的顺序文件
### 索引顺序文件
1. 一组记录对应一个索引表项
2. 提高检索效率可以建立多级索引表
# 文件目录
## 文件控制块
1. 目录本身就是一种有结构文件，由一条条记录组成，每条记录对应一个在该存放目录下的文件
2. 目录表项中存放了目录项在外存中的存放位置
3. FCB 的有序集合称为"文件目录"，一个 FCB 就是一个文件目录项，包含了文件的基本信息，存取控制信息和使用信息
4. FCB 实现了文件名和文件之间的映射
## 目录结构
### 单级目录结构 
1. 实现了按名存取，但不允许文件重名
2. 不适用于多用户操作系统
### 两级目录结构
1. 分为主文件目录 (MFD, Master File Directory) 和用户文件目录 (UFD, User File Directory)
2. 容易实现访问控制
3. 用户不能将自己的文件进行分类
### 多级目录结构
1. 又称树形目录结构
2. 从根目录出发的路径称为绝对路径
3. 很多时候用户会连续访问同一目录内的多个文件，可以设置一个当前目录文件，引入当前目录和相对路径后，磁盘 I/O 的次数减少了
4. 不方便实现文件的共享
### 无环图目录结构
1. 不同文件名可以指向同一个文件
2. 每个共享节点需要设置一个共享计数器，只有共享计数器减为 0 时，才删除节点
## 索引节点
1. 除了文件名之外文件名的描述信息都放入索引节点中
2. 索引节点机制可以提升文件的检索速度
3. 内存索引节点相对外存索引节点需要记录更多的信息，比如文件是否被修改，有多少个进程在访问文件等
# 物理结构
1. 文件的数据应该怎么样存放在外存中
2. 文件块：为了方便对文件数据的管理，文件的逻辑地址空间会被分为一个个文件块，文件的逻辑地址可以表示为 (逻辑块号, 块内地址) 的形式
3. 操作系统以块为单位为文件分配存储空间，用户通过逻辑地址操作自己的文件操作系统负责实现从逻辑地址到物理地址的映射
## 文件分配方式
### 连续分配
1. 要求每个文件在磁盘上占有一组连续的块
2. 文件目录项 (FCB) 中记录存放的起始块号和长度
3. 用户给出要访问的逻辑块号，操作系统找到该文件对应的目录项 (FCB)，物理块号 = 起始块号 + 逻辑块号，还需要验证用户提供的逻辑块号是否合法
#### 优点
1. 连续分配方式支持顺序访问和直接访问 (即随机访问)
2. 连续分配的文件在顺序读 / 写时速度最快
#### 缺点
1. 物理上采用连续分配的文件不方便拓展
2. 物理上采用连续分配，存储空间利用率低，会产生难以利用的磁盘碎片，可以用紧凑来处理碎片，但是需要耗费很大的时间代价

### 链接分配
#### 隐式分配
1. 每一磁盘块中保存指向下一个磁盘块的指针
2. 用户给出要访问的逻辑块号 i ，操作系统找到 FCB ，从目录项中找到起始块号从而按链式读入逻辑块
3. 缺点：隐式链接的方式只支持顺序访问，不支持随机访问，指向下一个盘块的指针需要耗费少量存储空间
4. 优点：方便文件拓展不会有碎片问题，外存利用率高
5. 题目中提到链接分配的文件默认指隐式链接的分配方式
#### 显式链接
1. 把用于链接文件各物理块的指针显式地存放在一张表中，即[[数据取证#FAT32#FAT 表|文件分配表 (FAT, File Allocation Table)]] 
2. 目录中只需记录文件的起始块号
3. 逻辑块号转换成物理块号的过程不需要读磁盘操作
4. 缺点：文件分配表需要占用一定的存储空间
5. 优点：外存利用率高，并且支持随机访问，相比隐式链接地址转换不需要访问磁盘，文件的访问效率更高

### 索引分配
1. 索引分配允许文件离散地分配在各个磁盘块中，系统为每个文件建立一张索引表，索引表存放的磁盘块称为索引块，文件数据存放的磁盘块称为数据块
2. 索引表中的逻辑块号可以是隐含的
3. 优点：索引分配方式支持随机访问，文件拓展也很容易实现
4. 缺点：索引表需要占用一定的存储空间
#### 文件索引表太大
1. 链接方案：将多个索引块链接起来存放
	1. FCB 中只需要记录第一个索引块的物理块号
	2. 需要多次读入索引块，效率低
2. 多层索引：建立多层索引 (原理类似于多级页表)
	1. 二级 (K) 索引访问目标数据块需要 3 (K + 1) 次磁盘 I/O，分别需要读入一级索引表二级索引表和目标数据块
3. 混合索引：顶级索引表中既包含直接地址索引，又包含一级间接索引，还包含二级间接索引
	1. 对于小文件，只需要较少次数的读磁盘操作
